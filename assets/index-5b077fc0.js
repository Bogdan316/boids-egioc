(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();var l={MAX_X:2e3,MIN_X:-2e3,MAX_Y:2e3,MIN_Y:-2e3,MAX_Z:2e3,MIN_Z:-2e3,WIDTH:4e3,HEIGHT:4e3,DEPTH:4e3,MAX_BOIDS:500,VLIM:100,DISPERSION:.2,RANGE:200};function R(){const i=new THREE.PerspectiveCamera(35,1,.1,1e5);return i.position.set(0,0,2500),i}function g(){const i=new THREE.HemisphereLight("white","darkslategrey",5),t=new THREE.DirectionalLight("white",8);return t.position.set(10,10,10),{ambientLight:i,mainLight:t}}function b(){return new THREE.Scene}function T(i,t){const o=new THREE.OrbitControls(i,t);return o.enablePan=!1,o.enableDamping=!0,o.maxDistance=1e4,o.tick=()=>o.update(),o}function H(){const i=new THREE.WebGLRenderer({antialias:!0});return i.physicallyCorrectLights=!0,i.autoClear=!1,i.setClearColor(0,0),i}const f=(i,t,o)=>{t.aspect=i.clientWidth/i.clientHeight,t.updateProjectionMatrix(),o.setSize(i.clientWidth,i.clientHeight),o.setPixelRatio(window.devicePixelRatio)};class S{constructor(t,o,e){f(t,o,e),window.addEventListener("resize",()=>{f(t,o,e)})}}const M=new THREE.Clock;class v{constructor(t,o,e){this.camera=t,this.scene=o,this.renderer=e,this.updatables=[]}start(){this.renderer.setAnimationLoop(()=>{this.tick(),this.renderer.render(this.scene,this.camera)})}stop(){this.renderer.setAnimationLoop(null)}tick(){const t=M.getDelta();for(const o of this.updatables)o.tick(t)}}function L(i,t){const o=i.scene.children[0];o.scale.set(t,t,t);const e=i.animations[0];return{model:o,clip:e}}async function A(){const t=await new THREE.GLTFLoader().loadAsync("./assets/models/Parrot.glb");return L(t,30)}const c=(i=0,t=0)=>Math.floor(Math.random()*(i+1-t))+t;class V extends THREE.Object3D{constructor(t,o){super(),this.model=t.clone(),this.velocity=new THREE.Vector3(c(100,-100)*.1,c(100,-100)*.1,c(100,-100)*.1),this.boost=new THREE.Vector3(0,0,0),this.acceleration=new THREE.Vector3(this.model),this.mixer=new THREE.AnimationMixer(this.model);const e=this.mixer.clipAction(o);e.startAt(Math.random()),e.play();const s=c(500,1e3),n=THREE.MathUtils.degToRad(c(180)),r=THREE.MathUtils.degToRad(c(360));this.position.y=Math.sin(n)*Math.sin(r)*s,this.position.x=Math.sin(n)*Math.cos(r)*s,this.position.z=Math.cos(n)*s,this.model.geometry.computeBoundingSphere(),this.boundingSphere=this.model.geometry.boundingSphere,this.add(this.model)}tick(t){this.mixer.update(t)}}const E=(i=0,t=0)=>Math.floor(Math.random()*(i+1-t))+t,m=7;class I extends THREE.Group{constructor(t){super(),this.bird=t,this.renderBoids()}renderBoids(){this.children=[];for(let t=0;t<l.MAX_BOIDS;t+=1)this.add(new V(this.bird.model,this.bird.clip))}disperse(){for(const t of this.children)t.boost.x=E(10,-10)*.1,t.boost.y=E(10,-10)*.1,t.boost.z=E(10,-10)*.1,t.boost=t.boost.normalize().multiplyScalar(7)}seekGoal(t,o){return o=o.sub(t.position).normalize().multiplyScalar(m),o.sub(t.velocity).clampLength(0,.04)}matchVelocity(t){var o=new THREE.Vector3(0,0,0);let e=0;for(const s of this.children){const n=t.position.distanceTo(s.position);n>0&&n<85&&(o=o.add(s.velocity),e++)}return e===0?new THREE.Vector3(0,0,0):o.divideScalar(e).normalize().multiplyScalar(m).sub(t.velocity).clampLength(0,.16)}avoidCollisions(t){let o=0;var e=new THREE.Vector3(0,0,0);for(const s of this.children){const n=t.position.distanceTo(s.position);n>0&&n<70&&(e=e.add(new THREE.Vector3(0,0,0).subVectors(t.position,s.position).normalize().divideScalar(n)),o++)}return o===0?new THREE.Vector3(0,0,0):(e=e.divideScalar(o).normalize().multiplyScalar(m),new THREE.Vector3(0,0,0).subVectors(e,t.velocity).clampLength(0,l.DISPERSION))}centerOfMass(t){var o=new THREE.Vector3(0,0,0);let e=0;for(const s of this.children){const n=s.position.distanceTo(t.position);n>0&&n<l.RANGE&&(o=o.add(s.position),e++)}return e==0?new THREE.Vector3(0,0,0):this.seekGoal(t,o.divideScalar(e))}boundPosition(t){const e=1500-t.position.length()-t.boundingSphere.radius;return t.position.clone().normalize().multiplyScalar(-1/Math.pow(e,2)).multiplyScalar(Math.pow(t.velocity.length(),3))}tick(t){for(const e of this.children){const s=this.avoidCollisions(e),n=this.centerOfMass(e),r=this.boundPosition(e),w=this.matchVelocity(e);e.boost=e.boost.multiplyScalar(.9),e.boost<.01&&(e.boost=new THREE.Vector3(0,0,0)),e.velocity=e.velocity.add(s).add(n).add(r).add(w).add(e.boost).clampLength(0,m),e.position.copy(e.position.add(e.velocity));var o=e.velocity.clone().multiplyScalar(10).add(e.position);e.lookAt(o),e.tick(t)}}}function D(){const i=new THREE.SphereGeometry(1500,100,100),t=new THREE.MeshLambertMaterial({color:"white",transparent:!0,opacity:.1,wireframe:!1,depthWrite:!1,blending:THREE.AdditiveBlending});return new THREE.Mesh(i,t)}let d,y,h,a,u;class O{constructor(t){h=R(),d=b(),a=H(),t.append(a.domElement),u=new v(h,d,a),y=T(h,a.domElement),u.updatables.push(y);const{ambientLight:o,mainLight:e}=g();d.add(o,e),new S(t,h,a)}render(){a.render(d,h)}start(){u.start()}stop(){u.stop()}async init(){this.birds=await A(),this.flock=new I(this.birds),u.updatables.push(this.flock);const t=D();t.add(this.flock),d.add(t)}restart(){this.flock.renderBoids(),this.render()}}let p=new dat.GUI;async function P(){const i=document.querySelector("#scene-container"),t=new O(i);let o=new function(){this.disperse=()=>{t.flock.disperse()},this.restart=()=>t.restart()};p.add(l,"MAX_BOIDS",50,800).onFinishChange(e=>t.restart()).name("Number"),p.add(l,"DISPERSION",.1,.5).name("Dispersion"),p.add(l,"RANGE",100,500).name("Visual Range"),p.add(o,"disperse").name("Disperse"),p.add(o,"restart").name("Reset"),await t.init(),t.start()}P().catch(i=>{console.error(i)});
